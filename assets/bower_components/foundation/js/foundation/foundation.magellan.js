!function(e,t,n,r){"use strict";Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.4.7",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30,fixed_top:0},init:function(e,t,n){Foundation.inherit(this,"throttle"),this.bindings(t,n)},events:function(){var n=this,r=n.S,i=n.settings;n.set_expedition_position(),r(n.scope).off(".magellan").on("click.fndtn.magellan","["+n.add_namespace("data-magellan-arrival")+'] a[href^="#"]',function(t){t.preventDefault();var r=e(this).closest("["+n.attr_name()+"]"),i=r.data("magellan-expedition-init"),o=this.hash.split("#").join(""),a=e("a[name='"+o+"']");0===a.length&&(a=e("#"+o));var s=a.offset().top-i.destination_threshold+1;s-=r.outerHeight(),e("html, body").stop().animate({scrollTop:s},700,"swing",function(){history.pushState?history.pushState(null,null,"#"+o):location.hash="#"+o})}).on("scroll.fndtn.magellan",n.throttle(this.check_for_arrivals.bind(this),i.throttle_delay)),e(t).on("resize.fndtn.magellan",n.throttle(this.set_expedition_position.bind(this),i.throttle_delay))},check_for_arrivals:function(){var e=this;e.update_arrivals(),e.update_expedition_positions()},set_expedition_position:function(){var t=this;e("["+this.attr_name()+"=fixed]",t.scope).each(function(n,r){var i,o,a=e(this),s=a.data("magellan-expedition-init"),u=a.attr("styles");a.attr("style",""),i=a.offset().top+s.threshold,o=parseInt(a.data("magellan-fixed-top")),isNaN(o)||(t.settings.fixed_top=o),a.data(t.data_attr("magellan-top-offset"),i),a.attr("style",u)})},update_expedition_positions:function(){var n=this,r=e(t).scrollTop();e("["+this.attr_name()+"=fixed]",n.scope).each(function(){var t=e(this),i=t.data("magellan-expedition-init"),o=t.attr("style"),a=t.data("magellan-top-offset");if(r+n.settings.fixed_top>=a){var s=t.prev("["+n.add_namespace("data-magellan-expedition-clone")+"]");0===s.length&&(s=t.clone(),s.removeAttr(n.attr_name()),s.attr(n.add_namespace("data-magellan-expedition-clone"),""),t.before(s)),t.css({position:"fixed",top:i.fixed_top}).addClass("fixed")}else t.prev("["+n.add_namespace("data-magellan-expedition-clone")+"]").remove(),t.attr("style",o).css("position","").css("top","").removeClass("fixed")})},update_arrivals:function(){var n=this,r=e(t).scrollTop();e("["+this.attr_name()+"]",n.scope).each(function(){var t=e(this),i=t.data(n.attr_name(!0)+"-init"),o=n.offsets(t,r),a=t.find("["+n.add_namespace("data-magellan-arrival")+"]"),s=!1;o.each(function(e,r){if(r.viewport_offset>=r.top_offset){var o=t.find("["+n.add_namespace("data-magellan-arrival")+"]");return o.not(r.arrival).removeClass(i.active_class),r.arrival.addClass(i.active_class),s=!0,!0}}),s||a.removeClass(i.active_class)})},offsets:function(t,n){var r=this,i=t.data(r.attr_name(!0)+"-init"),o=n;return t.find("["+r.add_namespace("data-magellan-arrival")+"]").map(function(n,a){var s=e(this).data(r.data_attr("magellan-arrival")),u=e("["+r.add_namespace("data-magellan-destination")+"="+s+"]");if(u.length>0){var c=Math.floor(u.offset().top-i.destination_threshold-t.outerHeight());return{destination:u,arrival:e(this),top_offset:c,viewport_offset:o}}}).sort(function(e,t){return e.top_offset<t.top_offset?-1:e.top_offset>t.top_offset?1:0})},data_attr:function(e){return this.namespace.length>0?this.namespace+"-"+e:e},off:function(){this.S(this.scope).off(".magellan"),this.S(t).off(".magellan")},reflow:function(){var t=this;e("["+t.add_namespace("data-magellan-expedition-clone")+"]",t.scope).remove()}}}(jQuery,window,window.document);